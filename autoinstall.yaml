autoinstall:
  version: 1
  identity:
    hostname: dev-notebook
    username: dev
    password: "$y$j9T$aPczz0EN.t6qnELbCi.j./$opwfKhHIC9LdvaSAsJwrx8bESxko.Dc6dWIfXK0k6nB"
  locale: en_US.UTF-8
  keyboard:
    layout: br
  timezone: "America/Maceio"  
  storage:
    layout:
      name: lvm
      password: "ENCRYPTION_PASSPHRASE_HERE"
    config:
      - id: disk0
        type: disk
        match:
          size: largest
        ptable: gpt
        wipe: superblock-recursive

      - id: efi
        type: partition
        device: disk0
        size: 250MiB
        flag: boot
        grub_device: true

      - id: pvpart
        type: partition
        device: disk0
        size: -1

      - id: pvcrypt
        type: dm_crypt
        volume: pvpart
        key: "ENCRYPTION_PASSPHRASE_HERE"

      - id: lvm_vg
        type: lvm_vg
        devices: [pvcrypt]
        name: vgubuntu

      - id: lv_root
        type: lvm_lv
        vg: lvm_vg
        name: root
        size: 50GiB
        fstype: ext4
        mountpoint: /

      - id: lv_swap
        type: lvm_lv
        vg: lvm_vg
        name: swap
        size: 70GiB
        fstype: swap

      - id: lv_home
        type: lvm_lv
        vg: lvm_vg
        name: home
        size: -1
        fstype: ext4
        mountpoint: /home
  packages:
    - curl
    - build-essential
    - git
    - gh         # GitHub CLI
    - code       # VS Code
  snaps:
    - name: docker
      classic: true
  late-commands:
    # Install Pixi via the official script
    - curtin in-target --target=/target bash -xc "curl -fsSL https://pixi.sh/install.sh | bash"
    # Fix ownership of Pixi in /home/dev/.pixi
    - curtin in-target --target=/target bash -xc "chown -R dev:dev /home/dev/.pixi"
    # Enable Pixi Bash completion
    - curtin in-target --target=/target bash -xc "echo 'eval \"\$(/home/dev/.pixi/bin/pixi completion --shell bash)\"' >> /home/dev/.bashrc"
    # Install global tools via Pixi, including pnpm
    # - curtin in-target --target=/target bash -xc "su - dev -c 'export PATH=\$HOME/.pixi/bin:\$PATH && pixi global install python nodejs yarn bun pnpm gh starship'"
    # Install Brave browser
    - curtin in-target --target=/target bash -xc "curl -fsS https://dl.brave.com/install.sh | sh"
    # Install VS Code extensions
    - curtin in-target --target=/target bash -xc "code --install-extension ms-python.python ms-vscode.vscode-typescript-next"
    # Set Git identity
    - curtin in-target --target=/target bash -xc "git config --global user.name 'leonardovff' && git config --global user.email 'leonardovff@gmail.com'"
    # Authenticate GitHub CLI (if token provided)
    # - curtin in-target --target=/target bash -xc "gh auth login --with-token <YOUR_TOKEN> || true"
